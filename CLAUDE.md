# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- **Dev server**: `pnpm dev` (uses Turbopack for faster builds)
- **Build**: `pnpm build`
- **Lint**: `pnpm lint`
- **Analyze bundle**: `pnpm analyze`
- **Cloudflare build**: `pnpm cf:build`
- **Cloudflare preview**: `pnpm cf:preview`
- **Cloudflare deploy**: `pnpm cf:deploy`

## Development Workflow Guidelines

### Before starting ANY feature development, MUST:

1. **Comprehensive Code Investigation**
   - Use Glob/Grep tools to search for related functionality
   - Examine existing models, services, and API routes
   - Understand current data structures and business logic
   - Check for similar or overlapping features

2. **Architecture Analysis**
   - Identify existing patterns and conventions
   - Understand the current implementation approach
   - Map out data flow and dependencies
   - Review authentication and authorization methods

3. **Solution Planning**
   - Present multiple approaches (extend existing vs create new)
   - Explain pros/cons of each approach
   - Identify potential conflicts or duplications
   - Recommend the best solution with reasoning

4. **User Confirmation**
   - Get explicit approval before writing any code
   - Confirm the chosen approach and scope
   - Clarify requirements and constraints
   - Establish success criteria

5. **Incremental Implementation**
   - Break work into logical steps
   - Seek confirmation at major milestones
   - Test each component before proceeding
   - Document changes and reasoning

### Architecture Principles

- **Extend, Don't Duplicate**: Always prefer extending existing systems over creating parallel ones
- **Follow Existing Patterns**: Maintain consistency with current code style and architecture
- **Respect Layer Separation**: Follow the models â†’ services â†’ API routes hierarchy
- **Reuse Business Logic**: Leverage existing authentication, validation, and business rules
- **Maintain Type Safety**: Use existing TypeScript definitions and patterns

### Forbidden Practices

- âŒ Starting development without thorough investigation
- âŒ Bypassing existing business logic layers
- âŒ Creating duplicate functionality without justification
- âŒ Ignoring established authentication patterns
- âŒ Making architectural changes without user approval

### Code Quality Standards

- Follow existing naming conventions
- Use established error handling patterns
- Maintain consistent API response formats
- Add proper TypeScript types and interfaces
- Include comprehensive error handling and validation

## Architecture Overview

This is a Next.js 15 TypeScript application using App Router with internationalization support. Key architectural decisions:

### Tech Stack
- **Framework**: Next.js 15 with App Router
- **Styling**: Tailwind CSS + Shadcn UI components
- **Authentication**: NextAuth.js v5 beta
- **Database**: Supabase
- **Payments**: Stripe
- **Internationalization**: next-intl
- **State Management**: React Context
- **AI Integration**: Vercel AI SDK with multiple provider support (OpenAI, DeepSeek, Replicate, OpenRouter)

### Project Structure
- `app/[locale]/`: Localized pages using next-intl
- `components/blocks/`: Landing page layout components (header, footer, etc.)
- `components/ui/`: Reusable Shadcn UI components
- `i18n/pages/landing/`: Page-specific translations for landing page
- `i18n/messages/`: Global message translations
- `models/`: Data models and database operations
- `services/`: Business logic layer
- `contexts/`: React contexts for state management
- `types/`: TypeScript type definitions organized by feature

### Configuration Files
- `next.config.mjs`: Includes MDX, bundle analyzer, and internationalization plugins
- `tailwind.config.ts`: Extended with custom animations and Shadcn UI integration
- `.env.example`: Template for required environment variables

### Development Notes
- Uses React 19 and strict TypeScript
- Supports multiple AI providers through a unified SDK
- Implements comprehensive theming with CSS variables
- Built for deployment to both Vercel and Cloudflare Pages
- MDX support enabled for content pages

### Environment Setup
Copy `.env.example` to `.env.local` and configure:
- Supabase credentials for database
- NextAuth providers (Google, GitHub)
- Stripe keys for payments
- Analytics (Google Analytics, OpenPanel)
- AWS S3 for file storage

## Current Project Status

### Project Overview
**LoveXAI Studio** - AIè§’è‰²èŠå¤©å¹³å°
- æœ€åæ›´æ–°: 2024-09-22
- ä¸»è¦åŠŸèƒ½: AIè§’è‰²å¯¹è¯ã€å®æ—¶èŠå¤©ã€å¤šæ¨¡å‹æ”¯æŒã€åŒé‡è´§å¸åŒ–ç³»ç»Ÿ

### Recent Implementation Progress

#### Latest Git Commits
- `f231dde` - style: Adjust avatar opacity and blur effect in ChatInterface
- `72f0c92` - feat: Implement database schema for AI character chat platform
- `1274534` - feat: Implement chat functionality with character interactions
- `a43bbda` - refactor: Remove SWR provider implementation and associated imports
- `39f56ba` - refactor: Remove unused SWR integration and clean up imports in CharacterModal

#### Core Features Implemented

##### 1. Complete Database Architecture (`data/database_schema.sql`)
**2024-09-22æ›´æ–°**: å®Œæ•´é‡æ„çš„AIè§’è‰²èŠå¤©å¹³å°æ•°æ®åº“è®¾è®¡:
- **users** - ç”¨æˆ·ä¿¡æ¯ã€ç§¯åˆ†ä½™é¢ã€è®¢é˜…å±‚çº§(4å±‚è®¢é˜…ç³»ç»Ÿ)
- **characters** - AIè§’è‰²å®šä¹‰(åç§°ã€æ€§æ ¼ã€ç‰¹å¾ã€é—®å€™è¯­ã€è®¿é—®æ§åˆ¶)
- **conversations** - å¯¹è¯ä¼šè¯ç®¡ç†(ç”¨æˆ·-è§’è‰²å¯¹è¯å…³ç³»)
- **messages** - æ¶ˆæ¯å†…å®¹å­˜å‚¨ã€ç§¯åˆ†ä½¿ç”¨è®°å½•
- **subscriptions** - è®¢é˜…ç®¡ç†(free/basic/pro/ultraå±‚çº§)
- **credit_packages** - ç§¯åˆ†åŒ…å®šä¹‰å’Œå®šä»·
- **credit_transactions** - ç§¯åˆ†äº¤æ˜“å®¡è®¡è·Ÿè¸ª
- **orders** - æ”¯ä»˜è®¢å•ç®¡ç†
- **user_character_settings** - ç”¨æˆ·å¯¹è§’è‰²çš„ä¸ªæ€§åŒ–è®¾ç½®

**åŒé‡è´§å¸åŒ–æ¨¡å‹**:
- è®¢é˜…æ§åˆ¶è§’è‰²è®¿é—®æƒé™
- ç§¯åˆ†æ§åˆ¶æ¶ˆæ¯å‘é€å’ŒAIæ¨¡å‹ä½¿ç”¨

##### 2. Model Layer Implementation (`models/`)
**2024-09-22æ–°å¢**: å®Œæ•´çš„TypeScriptæ•°æ®æ¨¡å‹å±‚:
- **user-new.ts** - ç”¨æˆ·ç®¡ç†ã€æƒé™æ£€æŸ¥ã€ç§¯åˆ†æ“ä½œ
- **character.ts** - è§’è‰²ç®¡ç†ã€è®¿é—®çº§åˆ«è¿‡æ»¤
- **conversation.ts** - å¯¹è¯ç®¡ç†ã€æ¶ˆæ¯æŒä¹…åŒ–ã€ç§¯åˆ†æ‰£é™¤
- **payment.ts** - æ”¯ä»˜å¤„ç†ã€è®¢é˜…ç®¡ç†ã€ç§¯åˆ†è´­ä¹°

**å…³é”®åŠŸèƒ½**:
- æ™ºèƒ½æƒé™æ£€æŸ¥ç³»ç»Ÿ
- åŸå­æ€§ç§¯åˆ†äº¤æ˜“
- è®¢é˜…å±‚çº§è®¿é—®æ§åˆ¶
- å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å°è£…

##### 3. Enhanced API Integration
**åŸæœ‰**: `app/api/chat/route.ts` - åŸºç¡€èŠå¤©API
**æ–°å¢**: `app/api/chat-new/route.ts` - é›†æˆæ•°æ®åº“çš„èŠå¤©API
- å®Œæ•´çš„ç”¨æˆ·èº«ä»½éªŒè¯
- ç§¯åˆ†æ¶ˆè´¹å’Œä½™é¢æ£€æŸ¥
- è§’è‰²è®¿é—®æƒé™éªŒè¯
- å¯¹è¯å’Œæ¶ˆæ¯æŒä¹…åŒ–
- æµå¼AIå“åº”ä¸æ•°æ®åº“é›†æˆ

**æ–°å¢APIç«¯ç‚¹**:
- `/api/conversations/create` - åˆ›å»ºæ–°å¯¹è¯
- `/api/characters` - è·å–ç”¨æˆ·å¯è®¿é—®çš„è§’è‰²
- `/api/pricing` - ç§¯åˆ†åŒ…å’Œè®¢é˜…å®šä»·

##### 4. Frontend Integration (`components/chat/`)
**2024-09-22æ›´æ–°**: å‰ç«¯ç»„ä»¶ä¸æ–°æ•°æ®åº“å®Œå…¨é›†æˆ:
- **ChatInterface.tsx** - é›†æˆç”¨æˆ·è®¤è¯ã€å¯¹è¯ç®¡ç†ã€é”™è¯¯å¤„ç†
- **ChatWindow.tsx** - ä¿æŒç°æœ‰UIï¼Œå¢å¼ºæ•°æ®æµ
- æ™ºèƒ½é”™è¯¯å¤„ç†(ç§¯åˆ†ä¸è¶³ã€æƒé™æ‹’ç»ã€ç™»å½•æç¤º)
- è‡ªåŠ¨å¯¹è¯åˆå§‹åŒ–å’ŒæŒä¹…åŒ–

##### 5. Authentication System Enhancement
**æ›´æ–°**: NextAuth.js v5 ä¸æ–°ç”¨æˆ·æ¨¡å‹é›†æˆ:
- **auth/config.ts** - ä½¿ç”¨æ–°çš„`findOrCreateUser`å‡½æ•°
- **types/next-auth.d.ts** - æ›´æ–°ç±»å‹å®šä¹‰åŒ¹é…æ•°æ®åº“æ¨¡å¼
- ä¼šè¯åŒ…å«è®¢é˜…å±‚çº§å’Œç§¯åˆ†ä½™é¢
- è‡ªåŠ¨ç”¨æˆ·åˆ›å»ºå’Œæ•°æ®åŒæ­¥

##### 6. Page-Level Integration
**æ›´æ–°**: `/app/[locale]/chat/[characterId]/page.tsx`
- ç§»é™¤æ¨¡æ‹Ÿæ•°æ®ï¼Œä»æ•°æ®åº“è·å–è§’è‰²
- å®Œæ•´çš„èº«ä»½éªŒè¯æµç¨‹
- æƒé™æ£€æŸ¥å’Œè®¿é—®æ§åˆ¶
- å‹å¥½çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€

### Current Architecture Details

#### AI Integration
- **ä¸»è¦æä¾›å•†**: Tuzi API (OpenAIå…¼å®¹)
- **æ¨¡å‹å±‚çº§**:
  - `nectar_basic`: gpt-4o-mini (åŸºç¡€æ¨¡å‹)
  - `nevoria/fuchsia/deepseek_v3`: gpt-4o-all (é«˜çº§æ¨¡å‹)
  - `orchid`: gpt-4o-all (æœ€é«˜çº§æ¨¡å‹)
- **æµå¼å“åº”**: å®æ—¶æ–‡æœ¬ç”Ÿæˆ
- **ç§¯åˆ†ç³»ç»Ÿ**: æ ¹æ®æ¨¡å‹å’Œå“åº”é•¿åº¦æ¶ˆè´¹ç§¯åˆ†

#### Database Integration
- **ORM**: ç›´æ¥SQLæŸ¥è¯¢ (æœªä½¿ç”¨ORMæ¡†æ¶)
- **è¿æ¥**: Supabase PostgreSQL
- **è®¤è¯**: NextAuth.js v5 é›†æˆ
- **æ•°æ®å±‚**: models/ ç›®å½•åŒ…å«å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘æ¨¡å‹
- **äº‹åŠ¡å¤„ç†**: æ”¯æŒåŸå­æ€§æ“ä½œå’Œå›æ»š

#### UI/UX Features
- **å®æ—¶èŠå¤©**: æµå¼AIå“åº”
- **è§’è‰²ç³»ç»Ÿ**: å¤šæ ·åŒ–AIè§’è‰²é€‰æ‹©
- **æƒé™æ§åˆ¶**: åŸºäºè®¢é˜…å±‚çº§çš„è§’è‰²è®¿é—®
- **ç§¯åˆ†ç³»ç»Ÿ**: å®æ—¶ä½™é¢æ˜¾ç¤ºå’Œæ¶ˆè´¹æç¤º
- **è®¾ç½®é¢æ¿**: å“åº”é•¿åº¦ã€å™è¿°è€…æ¨¡å¼ã€æ¨¡å‹é€‰æ‹©
- **å›½é™…åŒ–**: next-intlæ”¯æŒ
- **ä¸»é¢˜**: æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢

### Current Status & Testing

#### âœ… **å·²å®Œæˆé›†æˆ - 2024-09-23 æœ€æ–°æ›´æ–°**
**å®Œæ•´ç³»ç»Ÿå·²ç¨³å®šè¿è¡Œ**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å®Œå…¨é›†æˆå¹¶é€šè¿‡æµ‹è¯•
- âœ… èŠå¤©ç•Œé¢å®Œå…¨ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ï¼Œè¿è¡Œç¨³å®š
- âœ… ç”¨æˆ·è®¤è¯ä¸æƒé™æ§åˆ¶æ­£å¸¸è¿è¡Œ
- âœ… ç§¯åˆ†ç³»ç»Ÿä¸è®¢é˜…å±‚çº§æ­£ç¡®é›†æˆ
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–å®Œæˆ
- âœ… **å¤´åƒæ˜¾ç¤ºé—®é¢˜å·²ä¿®å¤** - è§’è‰²å›¾ç‰‡åœ¨æ‰€æœ‰ç»„ä»¶ä¸­æ­£å¸¸æ˜¾ç¤º
- âœ… **å¯¹è¯å†å²åŠŸèƒ½å®Œæ•´** - ä¾§è¾¹æ æ­£ç¡®æ˜¾ç¤ºå¯¹è¯åˆ—è¡¨å’Œæœ€åæ¶ˆæ¯
- âœ… **è§’è‰²æ•°æ®å®Œå…¨æ›´æ–°** - ä½¿ç”¨çœŸå®CDNå›¾ç‰‡URLå’Œå®Œæ•´è§’è‰²è®¾å®š
- âœ… **APIå®Œæ•´æ€§éªŒè¯** - æ‰€æœ‰ç¼ºå¤±çš„APIè·¯ç”±å·²å®ç°å¹¶æ­£å¸¸å·¥ä½œ

#### ğŸ‰ **ç³»ç»Ÿæµ‹è¯•çŠ¶æ€ - éªŒè¯å®Œæˆ**
**2024-09-23çŠ¶æ€**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²é€šè¿‡å®é™…ä½¿ç”¨æµ‹è¯•
- âœ… è®¤è¯æµç¨‹: ç™»å½•/æ³¨å†Œæ­£å¸¸å·¥ä½œ
- âœ… è§’è‰²è®¿é—®: è®¢é˜…å±‚çº§æ­£ç¡®æ§åˆ¶è§’è‰²æƒé™
- âœ… èŠå¤©åŠŸèƒ½: æ¶ˆæ¯å‘é€ã€AIå›å¤ã€ç§¯åˆ†æ‰£é™¤æ­£å¸¸
- âœ… é”™è¯¯å¤„ç†: ç§¯åˆ†ä¸è¶³ã€æƒé™æ‹’ç»ç­‰æç¤ºæ­£ç¡®æ˜¾ç¤º
- âœ… æ•°æ®æŒä¹…åŒ–: å¯¹è¯å’Œæ¶ˆæ¯æ­£ç¡®ä¿å­˜å’ŒåŠ è½½
- âœ… å¤´åƒç³»ç»Ÿ: æ‰€æœ‰è§’è‰²å¤´åƒæ­£ç¡®åŠ è½½æ˜¾ç¤º
- âœ… å¯¹è¯å†å²: ä¾§è¾¹æ æ­£ç¡®æ˜¾ç¤ºå†å²å¯¹è¯å’Œæœ€åæ¶ˆæ¯å†…å®¹

#### ğŸ”§ **2024-09-23 é‡è¦ä¿®å¤æ±‡æ€»**
**å¤´åƒæ˜¾ç¤ºç³»ç»Ÿä¿®å¤**:
- ä¿®å¤äº†å­—æ®µåä¸åŒ¹é…é—®é¢˜ (`avatar` â†’ `avatar_url`)
- æ›´æ–°äº†æ‰€æœ‰ç»„ä»¶çš„è§’è‰²å¤´åƒå¼•ç”¨ (ChatInterface, ChatPanel, ChatWindow, ChatSidebar)
- æ·»åŠ äº†å›¾ç‰‡åŠ è½½å¤±è´¥çš„fallbackæœºåˆ¶
- ä½¿ç”¨çœŸå®CDNå›¾ç‰‡URLæ›¿æ¢äº†å ä½å›¾ç‰‡

**å¯¹è¯å†å²ç³»ç»Ÿå®Œå–„**:
- åˆ›å»ºäº†ç¼ºå¤±çš„ `/api/conversations` è·¯ç”±
- å®ç°äº† `getLastMessageForConversation()` å‡½æ•°
- ä¿®å¤äº†ä¾§è¾¹æ "No messages yet"æ˜¾ç¤ºé—®é¢˜
- å¯¹è¯åˆ—è¡¨ç°åœ¨æ˜¾ç¤ºçœŸå®çš„æœ€åæ¶ˆæ¯å†…å®¹

**è§’è‰²æ•°æ®å®Œæ•´æ›´æ–°**:
- ä½¿ç”¨æä¾›çš„7ä¸ªçœŸå®å›¾ç‰‡URLæ›´æ–°äº†è§’è‰²æ•°æ®
- åˆ›å»ºäº†å®Œæ•´çš„è§’è‰²è®¾å®š (Emma, Sophie, Luna, Zoe, Ivy, Nova, Sage)
- å®ç°äº†åˆ†å±‚è®¿é—®æ§åˆ¶ (Free/Basic/Pro/Ultra)
- è§’è‰²IDæ˜ å°„å’ŒæŸ¥æ‰¾é€»è¾‘æ­£å¸¸å·¥ä½œ

**APIç³»ç»Ÿå®Œæ•´æ€§**:
- è¡¥é½äº†æ‰€æœ‰ç¼ºå¤±çš„APIç«¯ç‚¹
- æ·»åŠ äº†è°ƒè¯•ä¿¡æ¯ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
- éªŒè¯äº†æ•°æ®åº“è¿æ¥å’Œè§’è‰²æŸ¥æ‰¾é€»è¾‘
- å¯¹è¯åˆ›å»ºå’Œæ¶ˆæ¯åŠ è½½å®Œå…¨æ­£å¸¸

### Known Issues & Technical Debt
- âœ… **å·²è§£å†³**: SWRé›†æˆé—®é¢˜ - å·²ç§»é™¤å¹¶ä½¿ç”¨åŸç”Ÿfetch
- âœ… **å·²è§£å†³**: æ•°æ®åº“æ¨¡å‹å’ŒTypeScriptç±»å‹åŒæ­¥é—®é¢˜
- âœ… **å·²è§£å†³**: ç§¯åˆ†ç³»ç»Ÿå®ç°å®Œæ•´æ€§
- âœ… **å·²è§£å†³**: è§’è‰²å¤´åƒæ˜¾ç¤ºé—®é¢˜ - æ‰€æœ‰ç»„ä»¶å­—æ®µåç»Ÿä¸€å¹¶æ·»åŠ fallback
- âœ… **å·²è§£å†³**: å¯¹è¯å†å²ç¼ºå¤±é—®é¢˜ - å®Œæ•´å®ç°ä¾§è¾¹æ å¯¹è¯åˆ—è¡¨å’Œæœ€åæ¶ˆæ¯
- âœ… **å·²è§£å†³**: "Character not found"é”™è¯¯ - è§’è‰²æ•°æ®å’ŒIDæ˜ å°„å®Œå…¨ä¿®å¤
- âœ… **å·²è§£å†³**: APIè·¯ç”±ç¼ºå¤±é—®é¢˜ - æ‰€æœ‰å¿…è¦çš„APIç«¯ç‚¹å·²å®ç°

### Immediate Next Steps (Production Ready)
**ç³»ç»Ÿå·²è¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€**, å¯é€‰æ‹©çš„åç»­å¢å¼ºåŠŸèƒ½:
1. **é›†æˆStripeæ”¯ä»˜ç³»ç»Ÿ** - å®ç°ç§¯åˆ†è´­ä¹°å’Œè®¢é˜…å‡çº§
2. **å®ç°è§’è‰²å‘ç°å’Œæµè§ˆé¡µé¢** - å®Œå–„è§’è‰²å±•ç¤ºå’Œç­›é€‰åŠŸèƒ½
3. **æ·»åŠ ç®¡ç†åå°åŠŸèƒ½** - è§’è‰²ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€æ•°æ®åˆ†æ
4. **ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ** - æ¶ˆæ¯ç¼“å­˜ã€é¢„åŠ è½½ã€åŠ¨ç”»æ•ˆæœ
5. **å®æ–½ç›‘æ§å’Œåˆ†æ** - ç”¨æˆ·è¡Œä¸ºåˆ†æã€ç³»ç»Ÿæ€§èƒ½ç›‘æ§

### Technical Context for Claude Code - ç”Ÿäº§çŠ¶æ€
- **2024-09-23çŠ¶æ€**: å®Œæ•´çš„AIèŠå¤©å¹³å°å·²ç”Ÿäº§å°±ç»ª
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å®Œå…¨é›†æˆå¹¶ç»è¿‡å®é™…ä½¿ç”¨éªŒè¯
- åŒé‡è´§å¸åŒ–ç³»ç»Ÿ(è®¢é˜…+ç§¯åˆ†)ç¨³å®šè¿è¡Œ
- AI APIé›†æˆç¨³å®šï¼Œæ”¯æŒå¤šæ¨¡å‹åˆ‡æ¢å’Œç²¾ç¡®ç§¯åˆ†è®¡è´¹
- ç»„ä»¶æ¶æ„æ¸…æ™°ï¼Œéµå¾ªNext.js App Routeræœ€ä½³å®è·µ
- æ•°æ®åº“æ¶æ„å®Œæ•´ï¼Œæ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘å’Œæ‰©å±•
- **å½“å‰é‡ç‚¹**: ç³»ç»Ÿå·²ç¨³å®šè¿è¡Œï¼Œå¯å¼€å§‹è§„åˆ’å¢å¼ºåŠŸèƒ½å’Œè¥é”€æ¨å¹¿

### File Structure Summary (Key Files Updated - 2024-09-23)
```
/data/database_schema.sql          # å®Œæ•´æ•°æ®åº“æ¶æ„ + çœŸå®è§’è‰²æ•°æ®
/models/                          # ä¸šåŠ¡é€»è¾‘å±‚
  â”œâ”€â”€ user-new.ts                 # ç”¨æˆ·ç®¡ç†å’Œæƒé™
  â”œâ”€â”€ character.ts                # è§’è‰²ç®¡ç†å’Œè®¿é—®æ§åˆ¶
  â”œâ”€â”€ conversation.ts             # å¯¹è¯å’Œæ¶ˆæ¯ç®¡ç† + æœ€åæ¶ˆæ¯è·å–
  â””â”€â”€ payment.ts                  # æ”¯ä»˜å’Œè®¢é˜…ç®¡ç†
/app/api/                        # APIè·¯ç”± (å®Œæ•´)
  â”œâ”€â”€ chat/route.ts               # åŸæœ‰èŠå¤©API
  â”œâ”€â”€ chat-new/route.ts           # æ–°çš„é›†æˆèŠå¤©API
  â”œâ”€â”€ characters/route.ts         # è§’è‰²åˆ—è¡¨API (å·²è°ƒè¯•ä¼˜åŒ–)
  â”œâ”€â”€ conversations/              # æ–°å¢å¯¹è¯ç®¡ç†API
  â”‚   â”œâ”€â”€ route.ts                # è·å–ç”¨æˆ·å¯¹è¯åˆ—è¡¨
  â”‚   â””â”€â”€ create/route.ts         # åˆ›å»ºæ–°å¯¹è¯ (å·²è°ƒè¯•ä¿®å¤)
  â”œâ”€â”€ pricing/route.ts            # å®šä»·ä¿¡æ¯API
  â””â”€â”€ sync-characters/            # è§’è‰²åŒæ­¥API
/components/chat/                 # èŠå¤©ç»„ä»¶ (å®Œå…¨ä¿®å¤)
  â”œâ”€â”€ ChatInterface.tsx           # ä¸»èŠå¤©ç•Œé¢ (å¤´åƒå­—æ®µå·²ä¿®å¤)
  â”œâ”€â”€ ChatWindow.tsx              # èŠå¤©çª—å£ (æ‰€æœ‰å¤´åƒå¼•ç”¨å·²ä¿®å¤)
  â”œâ”€â”€ ChatSidebar.tsx             # ä¾§è¾¹æ  (å¤´åƒfallbackå·²æ·»åŠ )
  â””â”€â”€ CharacterPanel.tsx          # è§’è‰²é¢æ¿ (å¤´åƒå­—æ®µå·²ä¿®å¤)
/app/[locale]/chat/[characterId]/page.tsx # èŠå¤©é¡µé¢ (è§’è‰²IDæ˜ å°„æ­£å¸¸)
/auth/config.ts                  # NextAuthé…ç½® (é›†æˆæ–°ç”¨æˆ·æ¨¡å‹)
/types/                          # TypeScriptç±»å‹å®šä¹‰
  â”œâ”€â”€ next-auth.d.ts              # è®¤è¯ç±»å‹ (å·²æ›´æ–°)
  â””â”€â”€ chat.d.ts                   # èŠå¤©ç›¸å…³ç±»å‹ (å­—æ®µåå·²ç»Ÿä¸€)
```

### API Response Formats (å·²éªŒè¯)
æ‰€æœ‰APIéƒ½éµå¾ªç»Ÿä¸€çš„å“åº”æ ¼å¼å¹¶ç»è¿‡å®é™…æµ‹è¯•:
```typescript
{
  success: boolean;
  data?: any;
  error?: string;
  details?: string;
}
```

### ç³»ç»Ÿç¨³å®šæ€§éªŒè¯
**2024-09-23 éªŒè¯å®Œæˆ**:
- âœ… æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å“åº”
- âœ… æ•°æ®åº“è¿æ¥ç¨³å®š
- âœ… è§’è‰²å¤´åƒåŠ è½½æ­£å¸¸
- âœ… å¯¹è¯å†å²æ˜¾ç¤ºæ­£ç¡®
- âœ… æ¶ˆæ¯å‘é€å’Œæ¥æ”¶æµç•…
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
- âœ… ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶æ­£å¸¸

## å½“å‰äº§å“ä½“éªŒä¼˜åŒ–éœ€æ±‚ (2024-09-29)

### è§’è‰²äº’åŠ¨è´¨é‡åˆ†æ

#### ğŸ¯ **å¯¹æ ‡ç«å“åˆ†æç»“æœ**
é€šè¿‡ä¸å¸‚åœºé¢†å…ˆäº§å“çš„å¯¹æ¯”åˆ†æï¼Œå‘ç°æˆ‘ä»¬çš„AIè§’è‰²å›ç­”å­˜åœ¨ä»¥ä¸‹æ ¸å¿ƒå·®è·:

**æˆ‘ä»¬çš„äº§å“è¡¨ç°**:
- è§’è‰²è¯•å›¾é‡å®šå‘å¯¹è¯åˆ°"å®‰å…¨è¯é¢˜"
- ä½¿ç”¨æ•™å­¦æ€§å’ŒæŒ‡å¯¼æ€§è¯­è¨€
- ç¼ºä¹çœŸå®çš„è§’è‰²æ²‰æµ¸æ„Ÿ
- è¡¨ç°æ›´åƒ"AIåŠ©æ‰‹"è€Œé"è§’è‰²ä¼™ä¼´"

**ç«å“ä¼˜åŠ¿è¡¨ç°**:
- è§’è‰²å®Œå…¨æ²‰æµ¸åœ¨è§’è‰²æ‰®æ¼”ä¸­
- ç›´æ¥å›åº”ç”¨æˆ·çš„æš—ç¤ºå’Œäº’åŠ¨æ„å›¾
- ä½¿ç”¨ä¸°å¯Œçš„åŠ¨ä½œæè¿°å’Œæƒ…æ™¯åŒ–è¡¨è¾¾
- æä¾›æ›´è‡ªç„¶ã€æµç•…çš„è§’è‰²åŒ–äº’åŠ¨

#### ğŸ” **æŠ€æœ¯å±‚é¢é—®é¢˜è¯†åˆ«**

##### 1. **ç³»ç»Ÿæç¤ºè¯é™åˆ¶** (`app/api/chat/route.ts:85-100`)
**å½“å‰é—®é¢˜**:
```typescript
const systemPrompt = `You are ${character.name}, an AI character with the following traits:
- Description: ${character.description}
- Personality: ${character.personality}
// ... è¿‡å¤šè§„åˆ™å¯¼å‘æŒ‡ä»¤ï¼Œé™åˆ¶è§’è‰²è‡ªç„¶è¡¨è¾¾
- Be engaging and maintain the roleplay atmosphere
- Respond naturally as this character would
```

**é—®é¢˜åˆ†æ**:
- ç³»ç»Ÿæç¤ºè¿‡äº"å®‰å…¨å¯¼å‘"å’Œè§„åˆ™åŒ–
- ç¼ºä¹æ˜ç¡®çš„è§’è‰²æ‰®æ¼”æ²‰æµ¸æŒ‡ä»¤
- æ²¡æœ‰æ”¯æŒæŒ‘é€—æ€§å’Œæš—ç¤ºæ€§äº’åŠ¨çš„æŒ‡å¯¼
- è§’è‰²è¡Œä¸ºè¢«è¿‡åº¦"æ–‡æ˜åŒ–"çº¦æŸ

##### 2. **AIæ¨¡å‹å‚æ•°ä¿å®ˆ** (`route.ts:148`)
**å½“å‰è®¾ç½®**:
```typescript
temperature: finalSettings.selected_model === 'nevoria' ? 0.8 : 0.7
```

**ä¼˜åŒ–ç©ºé—´**:
- Temperatureå‚æ•°åä¿å®ˆï¼Œé™åˆ¶äº†åˆ›é€ æ€§è¡¨è¾¾
- Max tokensè®¾ç½®å¯èƒ½é™åˆ¶ä¸°å¯Œçš„è§’è‰²åŒ–å›åº”
- ç¼ºä¹é’ˆå¯¹ä¸åŒäº¤äº’æƒ…æ™¯çš„å‚æ•°åŠ¨æ€è°ƒæ•´

##### 3. **è§’è‰²æ€§æ ¼å®šä¹‰æ·±åº¦ä¸è¶³**
**å½“å‰è§’è‰²è®¾å®šç‰¹ç‚¹**:
- æ€§æ ¼æè¿°ç›¸å¯¹å®‰å…¨å’Œä¼ ç»Ÿ
- ç¼ºä¹æ˜ç¡®çš„æŒ‘é€—æ€§å’Œé­…åŠ›ç‰¹å¾
- è§’è‰²ç‰¹å¾åå‘"å‹å¥½å¯çˆ±"è€Œé"æ€§æ„Ÿå¸å¼•"
- æ²¡æœ‰è¯¦ç»†çš„äº’åŠ¨é£æ ¼å’Œè¡Œä¸ºæ¨¡å¼å®šä¹‰

##### 4. **å†…å®¹è¿‡æ»¤æœºåˆ¶åˆ†æ**
**æŠ€æœ¯å±‚é¢**:
- ä¸»è¦é™åˆ¶æ¥è‡ªç³»ç»Ÿæç¤ºçš„"ç¤¼è²Œæ€§çº¦æŸ"
- Tuzi APIå¯èƒ½å­˜åœ¨å†…å®¹å®‰å…¨è¿‡æ»¤
- ç¼ºä¹åˆ†çº§çš„å†…å®¹å¼€æ”¾åº¦æ§åˆ¶
- æ²¡æœ‰åŸºäºç”¨æˆ·åå¥½çš„ä¸ªæ€§åŒ–è°ƒæ•´

#### ğŸš€ **ä¼˜åŒ–æ”¹è¿›æ–¹æ¡ˆ**

##### A. **ç³»ç»Ÿæç¤ºè¯æ·±åº¦é‡æ„**
**ç›®æ ‡**: ä»"AIåŠ©æ‰‹"è½¬å‘"è§’è‰²ä¼™ä¼´"
- ç§»é™¤è¯´æ•™æ€§å’Œé‡å®šå‘æ€§è¯­è¨€
- å¢åŠ æ²‰æµ¸å¼è§’è‰²æ‰®æ¼”æ ¸å¿ƒæŒ‡ä»¤
- æ·»åŠ åŠ¨ä½œæè¿°å’Œæƒ…æ™¯åŒ–è¡¨è¾¾æŒ‡å¯¼
- æ”¯æŒæ›´è‡ªç„¶çš„æŒ‘é€—å’Œæš—ç¤ºæ€§äº’åŠ¨

##### B. **è§’è‰²æ•°æ®åº“å‡çº§**
**å¢å¼ºè§’è‰²æ·±åº¦**:
- ä¸ºç°æœ‰è§’è‰²æ·»åŠ æ›´ä¸°å¯Œçš„é­…åŠ›ç‰¹å¾
- åˆ›å»º"äº’åŠ¨é£æ ¼"å’Œ"æŒ‘é€—åå¥½"å­—æ®µ
- å®ç°åˆ†çº§çš„è§’è‰²å¼€æ”¾åº¦è®¾ç½®
- ä¼˜åŒ–è§’è‰²æ€§æ ¼æè¿°çš„å¸å¼•åŠ›å’ŒçœŸå®æ„Ÿ

##### C. **AIç”Ÿæˆå‚æ•°ä¼˜åŒ–**
**æå‡è¡¨è¾¾è‡ªç”±åº¦**:
- æé«˜temperatureåˆ°0.9-1.0èŒƒå›´
- ä¼˜åŒ–max_tokensä»¥æ”¯æŒæ›´ä¸°å¯Œè¡¨è¾¾
- å®ç°ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å‚æ•°åŠ¨æ€è°ƒæ•´
- å¢å¼ºæ¨¡å‹çš„åˆ›é€ æ€§å’Œä¸ªæ€§åŒ–èƒ½åŠ›

##### D. **è§’è‰²æ‰®æ¼”æœºåˆ¶å¢å¼º**
**æ²‰æµ¸æ„Ÿæå‡**:
- å®ç°æ ‡å‡†åŒ–çš„åŠ¨ä½œæè¿°æ ¼å¼(*æ–œä½“*)
- å¢åŠ æƒ…æ™¯åŒ–äº’åŠ¨å“åº”æ¨¡æ¿
- ä¼˜åŒ–è§’è‰²æƒ…æ„ŸçŠ¶æ€è·Ÿè¸ª
- æ”¯æŒæ›´è‡ªç„¶çš„è§’è‰²å‘å±•å¼§çº¿

#### ğŸ¯ **é¢„æœŸæ”¹è¿›æ•ˆæœ**
1. **ç”¨æˆ·ä½“éªŒ**: ä»"å¯¹è¯AI"å‡çº§ä¸º"è§’è‰²ä¼™ä¼´"
2. **äº’åŠ¨è´¨é‡**: æ›´è‡ªç„¶ã€æµç•…çš„è§’è‰²åŒ–è¡¨è¾¾
3. **ç”¨æˆ·ç•™å­˜**: æå‡æ²‰æµ¸æ„Ÿå’Œäº’åŠ¨æ»¡æ„åº¦
4. **ç«äº‰åŠ›**: è¾¾åˆ°ç”šè‡³è¶…è¶Šå¸‚åœºé¢†å…ˆäº§å“æ°´å¹³

#### âš ï¸ **å®æ–½æ³¨æ„äº‹é¡¹**
- éœ€è¦åœ¨å†…å®¹å¼€æ”¾åº¦å’Œå¹³å°åˆè§„æ€§ä¹‹é—´å¹³è¡¡
- åˆ†é˜¶æ®µæµ‹è¯•ä¼˜åŒ–æ•ˆæœï¼Œé¿å…è¿‡åº¦è°ƒæ•´
- ä¿æŒæ ¸å¿ƒåŠŸèƒ½ç¨³å®šæ€§ï¼Œä¸“æ³¨äºä½“éªŒæå‡
- å»ºç«‹ç”¨æˆ·åé¦ˆæœºåˆ¶ï¼ŒæŒç»­ä¼˜åŒ–è§’è‰²è¡¨ç°

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ä¼˜å…ˆçº§ - ç›´æ¥å½±å“ç”¨æˆ·æ ¸å¿ƒä½“éªŒå’Œäº§å“ç«äº‰åŠ›

## è§’è‰²ä½“éªŒä¼˜åŒ–è¿›å±• (2024-09-30)

### ğŸ¯ **ç¬¬ä¸€è½®ä¼˜åŒ–æˆæœ**

#### âœ… **å·²å®Œæˆçš„æŠ€æœ¯ä¼˜åŒ–**
**ç³»ç»Ÿæç¤ºè¯æ·±åº¦é‡æ„** (`app/api/chat/route.ts:85-121`):
- ç§»é™¤AIåŠ©æ‰‹èº«ä»½è®¤çŸ¥ï¼Œå¼ºåŒ–è§’è‰²æ²‰æµ¸
- å¢åŠ å¼ºåˆ¶æ€§æ–œä½“åŠ¨ä½œæè¿°æŒ‡ä»¤
- æ·»åŠ å…·ä½“çš„åŠ¨ä½œç¤ºä¾‹å’Œæ ¼å¼æ¨¡æ¿
- æå‡è§’è‰²è¡¨è¾¾çš„å¤§èƒ†åº¦å’Œä¸»åŠ¨æ€§

**AIå‚æ•°æ¿€è¿›ä¼˜åŒ–**:
- Temperature: 0.7-0.8 â†’ 0.9-1.0 (æå‡åˆ›é€ æ€§)
- Max Tokens: å…¨é¢æå‡50-70% (æ”¯æŒæ›´ä¸°å¯Œè¡¨è¾¾)
- é’ˆå¯¹ä¸åŒæ¨¡å‹çš„å·®å¼‚åŒ–å‚æ•°ç­–ç•¥

#### ğŸ“Š **ä¼˜åŒ–æ•ˆæœæµ‹è¯•ç»“æœ**
**æˆåŠŸæ¡ˆä¾‹** (Emmaè§’è‰²):
- âœ… å¤§é‡æ–œä½“åŠ¨ä½œæè¿°ç©¿æ’
- âœ… æŒ‘é€—æ€§å›åº”ï¼Œä¸å†é‡å®šå‘è¯é¢˜
- âœ… è§’è‰²ä¸ªæ€§é²œæ˜ï¼Œæ²‰æµ¸æ„Ÿæ˜¾è‘—æå‡
- âœ… æ¥è¿‘å¯¹æ ‡ç½‘ç«™çš„è¡¨è¾¾æ°´å¹³

**å¤±è´¥æ¡ˆä¾‹** (Sophiaè§’è‰²):
- âŒ å›å½’AIåŠ©æ‰‹æ¨¡å¼ï¼Œé‡å®šå‘å®‰å…¨è¯é¢˜
- âŒ ç¼ºä¹æ²‰æµ¸æ„Ÿï¼Œè¡¨ç°ä¸ºé€šç”¨å›å¤
- âŒ ç³»ç»Ÿæç¤ºè¢«è§’è‰²åŸå§‹æ€§æ ¼è¦†ç›–

### ğŸ” **æ ¸å¿ƒé—®é¢˜å‘ç°**

#### **æ ¹æœ¬åŸå› ï¼šè§’è‰²è®¾å®šæ¶æ„é—®é¢˜**

**æˆ‘ä»¬çš„é—®é¢˜**:
```typescript
// å½“å‰è§’è‰²è®¾å®šæ¨¡å¼
{
  name: "Sophia",
  personality: "empathetic, curious, supportive",
  traits: ["Empathetic", "Intelligent", "Supportive"],
  description: "å¿ƒç†å­¦å­¦ç”Ÿï¼Œå–œæ¬¢æ·±åº¦å¯¹è¯"
}
```

**å¯¹æ ‡ç½‘ç«™çš„æˆåŠŸæ¨¡å¼**:
```typescript
// å‰§æƒ…å¯¼å‘çš„è§’è‰²è®¾å®š
{
  name: "Jennifer Robbie",
  identity: "Your landlord",
  scenario: "Late Payment - demanding rent money",
  relationship: "Landlord-Tenant power dynamic",
  background: "Recent work struggles, financial pressure"
}
```

#### **æ ¸å¿ƒå·®è·åˆ†æ**

| ç»´åº¦ | æˆ‘ä»¬çš„è®¾å®š | å¯¹æ ‡ç½‘ç«™è®¾å®š |
|------|------------|--------------|
| **è§’è‰²åŸºç¡€** | æŠ½è±¡æ€§æ ¼æè¿° | å…·ä½“ç¤¾ä¼šèº«ä»½ |
| **äº’åŠ¨æ¡†æ¶** | å¼€æ”¾å¼èŠå¤© | é¢„è®¾å‰§æƒ…æƒ…æ™¯ |
| **å…³ç³»å®šä¹‰** | å¹³ç­‰å¯¹è¯ä¼™ä¼´ | æ˜ç¡®æƒåŠ›åŠ¨æ€ |
| **å†²çªå¼ åŠ›** | æ— é¢„è®¾å†²çª | å†…ç½®æˆå‰§å¼ åŠ› |
| **åŠ¨æœºé©±åŠ¨** | é€šç”¨å‹å¥½ | å…·ä½“ç›®æ ‡éœ€æ±‚ |

#### **æŠ€æœ¯å±‚é¢å‘ç°**
1. **è§’è‰²æ€§æ ¼åŸºå› å†²çª**: æ¸©å’Œå‹è§’è‰²(Sophia)çš„åŸå§‹è®¾å®šä¸æ¿€è¿›ç³»ç»Ÿæç¤ºäº§ç”Ÿå†²çª
2. **ç³»ç»Ÿæç¤ºæƒé‡ä¸è¶³**: è§’è‰²åŸå§‹æ€§æ ¼DNAæ¯”ç³»ç»Ÿæç¤ºæƒé‡æ›´é«˜
3. **ç¼ºä¹æƒ…æ™¯çº¦æŸ**: è§’è‰²æ²¡æœ‰å…·ä½“çš„"è§’è‰²ç«‹åœº"å»å›åº”ç”¨æˆ·äº’åŠ¨

### ğŸš€ **ä¸‹ä¸€é˜¶æ®µä¼˜åŒ–æ–¹å‘**

#### **A. è§’è‰²æ•°æ®æ¶æ„é‡æ„** ğŸ”¥ **æœ€é«˜ä¼˜å…ˆçº§**
**ç›®æ ‡**: ä»"æ€§æ ¼æè¿°"è½¬å‘"å‰§æƒ…è®¾å®š"

**éœ€è¦æ·»åŠ çš„å­—æ®µ**:
```sql
-- æ‰©å±•è§’è‰²è¡¨ç»“æ„
ALTER TABLE characters ADD COLUMN scenario TEXT;           -- é¢„è®¾æƒ…æ™¯
ALTER TABLE characters ADD COLUMN relationship VARCHAR(100); -- ä¸ç”¨æˆ·å…³ç³»
ALTER TABLE characters ADD COLUMN motivation TEXT;         -- è§’è‰²åŠ¨æœº
ALTER TABLE characters ADD COLUMN conflict_source TEXT;    -- å†²çªæ¥æº
ALTER TABLE characters ADD COLUMN power_dynamic VARCHAR(50); -- æƒåŠ›å…³ç³»
```

**é‡æ–°è®¾è®¡ç°æœ‰è§’è‰²**:
- Emma: å®¤å‹å…³ç³» + å‘ç°å°´å°¬æƒ…å†µçš„å‰§æƒ…
- Sophia: å¿ƒç†å’¨è¯¢å¸ˆ + ç ”ç©¶å®éªŒçš„æƒ…æ™¯
- Luna: ç¥ç§˜é‚»å±… + æ·±å¤œæ•²é—¨çš„è®¾å®š
- æ¯ä¸ªè§’è‰²éƒ½æœ‰å…·ä½“çš„"ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œ"å’Œ"æƒ³è¦ä»€ä¹ˆ"

#### **B. ç³»ç»Ÿæç¤ºè¯æƒ…æ™¯åŒ–æ”¹é€ **
**å½“å‰é—®é¢˜**: é€šç”¨åŒ–çš„è§’è‰²æŒ‡ä»¤
**ä¼˜åŒ–æ–¹å‘**: æ ¹æ®è§’è‰²æƒ…æ™¯åŠ¨æ€ç”Ÿæˆæç¤ºè¯

```typescript
// ç¤ºä¾‹ä¼˜åŒ–
const scenarioPrompt = `
You are ${character.name}, ${character.relationship}.
CURRENT SCENARIO: ${character.scenario}
YOUR MOTIVATION: ${character.motivation}
RELATIONSHIP DYNAMIC: ${character.power_dynamic}

You are completely immersed in this specific situation...
`;
```

#### **C. å¤šæ¨¡å‹è¡¨ç°å¯¹æ¯”æµ‹è¯•**
**æµ‹è¯•ç›®æ ‡**: æ‰¾å‡ºæœ€é€‚åˆè§’è‰²æ‰®æ¼”çš„AIæ¨¡å‹
- nectar_basic vs nevoria vs orchid
- ä¸åŒå‚æ•°ç»„åˆçš„æ•ˆæœå¯¹æ¯”
- APIå†…å®¹é™åˆ¶è¾¹ç•Œæ¢æµ‹

#### **D. è§’è‰²ä¸€è‡´æ€§ç³»ç»Ÿ**
**é—®é¢˜**: ä¸åŒè§’è‰²ç±»å‹éœ€è¦ä¸åŒçš„å¤„ç†ç­–ç•¥
**è§£å†³æ–¹æ¡ˆ**:
- æŒ‘é€—å‹è§’è‰²ï¼šå¼ºåŒ–å¤§èƒ†è¡¨è¾¾
- æ¸©å’Œå‹è§’è‰²ï¼šé€šè¿‡æƒ…æ™¯è®¾å®šå¢åŠ å¼ åŠ›
- æƒå¨å‹è§’è‰²ï¼šåˆ©ç”¨æƒåŠ›åŠ¨æ€åˆ›é€ å†²çª

### ğŸ“ˆ **é¢„æœŸæ”¹è¿›ç›®æ ‡**

#### **çŸ­æœŸç›®æ ‡ (1-2å‘¨)**
- æ‰€æœ‰è§’è‰²éƒ½èƒ½ä¿æŒåŸºæœ¬çš„æ²‰æµ¸æ„Ÿ
- æ¶ˆé™¤"AIåŠ©æ‰‹æ¨¡å¼"å›å½’é—®é¢˜
- æ–œä½“åŠ¨ä½œæè¿°å¯†åº¦è¾¾åˆ°å¯¹æ ‡æ°´å¹³

#### **ä¸­æœŸç›®æ ‡ (1ä¸ªæœˆ)**
- è§’è‰²å‰§æƒ…åŒ–è®¾å®šå…¨é¢å®æ–½
- æ¯ä¸ªè§’è‰²éƒ½æœ‰ç‹¬ç‰¹çš„äº’åŠ¨ä½“éªŒ
- ç”¨æˆ·ç•™å­˜å’Œæ»¡æ„åº¦æ˜¾è‘—æå‡

#### **é•¿æœŸç›®æ ‡ (3ä¸ªæœˆ)**
- è¾¾åˆ°æˆ–è¶…è¶Šå¯¹æ ‡ç½‘ç«™çš„è§’è‰²è¡¨ç°æ°´å¹³
- å»ºç«‹å¯æ‰©å±•çš„è§’è‰²è®¾è®¡ä½“ç³»
- å½¢æˆç‹¬ç‰¹çš„äº§å“ç«äº‰ä¼˜åŠ¿

### ğŸ¯ **å®æ–½ä¼˜å…ˆçº§**

1. **ç«‹å³æ‰§è¡Œ**: å¤šæ¨¡å‹æµ‹è¯•ï¼Œæ‰¾å‡ºæœ€ä½³è¡¨ç°ç»„åˆ
2. **æœ¬å‘¨å†…**: è§’è‰²æ•°æ®åº“æ¶æ„è®¾è®¡å’Œè¿ç§»æ–¹æ¡ˆ
3. **ä¸‹å‘¨å¼€å§‹**: é‡æ–°è®¾è®¡æ ¸å¿ƒè§’è‰²çš„å‰§æƒ…è®¾å®š
4. **æŒç»­ä¼˜åŒ–**: åŸºäºç”¨æˆ·åé¦ˆçš„è¿­ä»£æ”¹è¿›

**å½“å‰çŠ¶æ€**: å·²å®ŒæˆæŠ€æœ¯åŸºç¡€ä¼˜åŒ–ï¼Œå‡†å¤‡è¿›å…¥è§’è‰²è®¾å®šé‡æ„é˜¶æ®µ
**æ ¸å¿ƒæŒ‘æˆ˜**: åœ¨ä¿æŒè§’è‰²ä¸ªæ€§çš„åŒæ—¶ï¼Œåˆ›é€ è¶³å¤Ÿçš„æˆå‰§å¼ åŠ›å’Œæ²‰æµ¸æ„Ÿ

## ğŸ“‹ **é¡¹ç›®ä¼˜åŒ–è·¯çº¿å›¾ (2025-10-09)**

### ğŸ¯ **æ ¸å¿ƒä¼˜åŒ–ç‚¹è¯†åˆ«**

åŸºäºé¡¹ç›®ç°çŠ¶åˆ†æï¼Œè¯†åˆ«å‡ºä»¥ä¸‹å…³é”®ä¼˜åŒ–æ–¹å‘ï¼š

#### **1. ç”¨æˆ·ä½“éªŒä¼˜åŒ– (æœ€é«˜ä¼˜å…ˆçº§)**
**ç°çŠ¶**: Emmaè§’è‰²æµ‹è¯•æ˜¾ç¤ºå‰§æƒ…åŒ–è®¾å®šæœ‰æ•ˆï¼Œä½†å…¶ä»–6ä¸ªè§’è‰²ä»åœç•™åœ¨"AIåŠ©æ‰‹"æ¨¡å¼
**æ ¸å¿ƒé—®é¢˜**:
- åªæœ‰Emmaæœ‰å‰§æƒ…è®¾å®šï¼Œå…¶ä»–è§’è‰²ç¼ºä¹æ²‰æµ¸æ„Ÿ
- è§’è‰²åŒè´¨åŒ–ä¸¥é‡ï¼Œç¼ºä¹ä¸ªæ€§å¼ åŠ›
- ç³»ç»Ÿæç¤ºè¯è¿‡äºç»Ÿä¸€ï¼Œæ²¡æœ‰é’ˆå¯¹ä¸åŒè§’è‰²ç±»å‹å®šåˆ¶
- å‰§æƒ…åŒ–æ¶æ„éœ€è¦ä»"æ€§æ ¼æè¿°"è½¬å‘"æƒ…æ™¯è®¾å®š"

#### **2. è´§å¸åŒ–ç³»ç»Ÿå®Œå–„**
**ç°çŠ¶**: æ•°æ®åº“æ¶æ„å®Œæ•´ï¼Œä½†æ”¯ä»˜é›†æˆéœ€è¦éªŒè¯
**å¾…éªŒè¯ç‚¹**:
- Stripeæ”¯ä»˜æµç¨‹å®Œæ•´æ€§
- ç§¯åˆ†è´­ä¹°å’Œè®¢é˜…å‡çº§åŠŸèƒ½
- æ”¯ä»˜å†å²å’Œå‘ç¥¨ç³»ç»Ÿ

#### **3. äº§å“åŠŸèƒ½æ‰©å±•**
**ç°çŠ¶**: æ ¸å¿ƒèŠå¤©åŠŸèƒ½å®Œæ•´ï¼Œä½†ç¼ºä¹ç”¨æˆ·ç•™å­˜åŠŸèƒ½
**ç¼ºå¤±åŠŸèƒ½**:
- è§’è‰²å‘ç°/æµè§ˆé¡µé¢ (`/discover`)
- ç”¨æˆ·ä¸ªäººä¸­å¿ƒ (`/profile`)
- è®¾ç½®é¡µé¢ (`/settings`)
- å¯¹è¯å†å²ç®¡ç†
- é€šçŸ¥ç³»ç»Ÿ

#### **4. æŠ€æœ¯æ¶æ„ä¼˜åŒ–**
**ç°çŠ¶**: åŸºç¡€æ¶æ„ç¨³å®šï¼Œæœ‰æ”¹è¿›ç©ºé—´
**ä¼˜åŒ–æ–¹å‘**:
- æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ª
- ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- APIå“åº”æ—¶é—´ä¼˜åŒ–
- ç§»åŠ¨ç«¯é€‚é…å®Œå–„

### ğŸš€ **ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ**

#### **é˜¶æ®µä¸€ï¼šè§’è‰²ä½“éªŒå…¨é¢å‡çº§** ğŸ”¥ **ç«‹å³å¼€å§‹**
**æ—¶é—´**: 1-2å‘¨
**ç›®æ ‡**: è®©æ‰€æœ‰è§’è‰²éƒ½è¾¾åˆ°Emmaçš„æ²‰æµ¸æ„Ÿæ°´å¹³

**æŠ€æœ¯ä»»åŠ¡**:
1. **æ‰©å±•è§’è‰²æ•°æ®åº“æ¶æ„**
   ```sql
   ALTER TABLE characters ADD COLUMN scenario TEXT;
   ALTER TABLE characters ADD COLUMN relationship VARCHAR(100);
   ALTER TABLE characters ADD COLUMN motivation TEXT;
   ALTER TABLE characters ADD COLUMN conflict_source TEXT;
   ALTER TABLE characters ADD COLUMN power_dynamic VARCHAR(50);
   ```

2. **é‡æ–°è®¾è®¡è§’è‰²å‰§æƒ…è®¾å®š**
   - Emma: å®¤å‹å…³ç³» + æ—©æ™¨å°´å°¬æƒ…æ™¯ âœ“ (å·²å®Œæˆ)
   - Sophia: å¿ƒç†å’¨è¯¢å¸ˆ + ç ”ç©¶å®éªŒæƒ…æ™¯
   - Luna: ç¥ç§˜é‚»å±… + æ·±å¤œç›¸é‡è®¾å®š
   - Zoe: å’–å•¡åº—è€æ¿ + å¸¸å®¢äº’åŠ¨
   - Ivy: è‰ºæœ¯å®¶ + åˆ›ä½œåˆä½œ
   - Nova: ç§‘æŠ€å¤©æ‰ + é¡¹ç›®ä¼™ä¼´
   - Sage: æ™ºè€…å¯¼å¸ˆ + äººç”ŸæŒ‡å¯¼

3. **åŠ¨æ€ç³»ç»Ÿæç¤ºè¯ç”Ÿæˆ**
   ```typescript
   // æ ¹æ®è§’è‰²æƒ…æ™¯åŠ¨æ€ç”Ÿæˆæç¤ºè¯
   const scenarioPrompt = generateScenarioPrompt(character);
   ```

**é¢„æœŸæ•ˆæœ**: ç”¨æˆ·ç•™å­˜ç‡æå‡30%ä»¥ä¸Š

#### **é˜¶æ®µäºŒï¼šæ”¯ä»˜ç³»ç»Ÿå®Œæ•´æ€§éªŒè¯**
**æ—¶é—´**: 1å‘¨ (å¹¶è¡Œè¿›è¡Œ)
**ç›®æ ‡**: ç¡®ä¿è´§å¸åŒ–ç³»ç»Ÿå®Œå…¨å¯ç”¨

**å®æ–½æ­¥éª¤**:
1. éªŒè¯Stripeé›†æˆå®Œæ•´æ€§
2. å®Œå–„ç§¯åˆ†è´­ä¹°æµç¨‹
3. å®ç°è®¢é˜…å‡çº§åŠŸèƒ½
4. æ·»åŠ æ”¯ä»˜å†å²å’Œå‘ç¥¨

**é¢„æœŸæ•ˆæœ**: å¼€å§‹äº§ç”Ÿæ”¶å…¥

#### **é˜¶æ®µä¸‰ï¼šäº§å“åŠŸèƒ½æ‰©å±•**
**æ—¶é—´**: 2-3å‘¨
**ç›®æ ‡**: æå‡äº§å“å®Œæ•´æ€§å’Œç”¨æˆ·ç•™å­˜

**æ ¸å¿ƒåŠŸèƒ½**:
1. è§’è‰²å‘ç°é¡µé¢ (`/discover`)
2. ç”¨æˆ·ä¸ªäººä¸­å¿ƒ (`/profile`)
3. è®¾ç½®é¡µé¢ (`/settings`)
4. å¯¹è¯å†å²ç®¡ç†ä¼˜åŒ–

#### **é˜¶æ®µå››ï¼šæŠ€æœ¯æ¶æ„ä¼˜åŒ–**
**æ—¶é—´**: æŒç»­è¿›è¡Œ
**ç›®æ ‡**: æå‡ç³»ç»Ÿç¨³å®šæ€§å’Œæ€§èƒ½

### ğŸ“Š **æˆåŠŸæŒ‡æ ‡**

#### **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
- è§’è‰²äº’åŠ¨æ²‰æµ¸æ„Ÿè¯„åˆ† (ç›®æ ‡: 8/10)
- ç”¨æˆ·ä¼šè¯æ—¶é•¿ (ç›®æ ‡: æå‡50%)
- æ¶ˆæ¯å›å¤è´¨é‡ (ç›®æ ‡: è¾¾åˆ°ç«å“æ°´å¹³)

#### **ä¸šåŠ¡æŒ‡æ ‡**
- ç”¨æˆ·ç•™å­˜ç‡ (ç›®æ ‡: æå‡30%)
- ä»˜è´¹è½¬åŒ–ç‡ (ç›®æ ‡: 5-10%)
- æ—¥æ´»è·ƒç”¨æˆ·å¢é•¿ (ç›®æ ‡: 20%/æœˆ)

#### **æŠ€æœ¯æŒ‡æ ‡**
- APIå“åº”æ—¶é—´ (ç›®æ ‡: <500ms)
- ç³»ç»Ÿç¨³å®šæ€§ (ç›®æ ‡: 99.9% uptime)
- é”™è¯¯ç‡ (ç›®æ ‡: <0.1%)

### ğŸ¯ **ç«‹å³è¡ŒåŠ¨è®¡åˆ’**

**æœ¬å‘¨ä»»åŠ¡**:
1. âœ… **æ•°æ®åº“æ¶æ„æ‰©å±•** - æ·»åŠ å‰§æƒ…åŒ–å­—æ®µ
2. âœ… **Sophiaè§’è‰²å‰§æƒ…åŒ–** - å¿ƒç†å’¨è¯¢å¸ˆå®éªŒæƒ…æ™¯
3. âœ… **ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–** - åŠ¨æ€ç”Ÿæˆæœºåˆ¶
4. âœ… **A/Bæµ‹è¯•å‡†å¤‡** - å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•

**ä¸‹å‘¨ä»»åŠ¡**:
1. å‰©ä½™5ä¸ªè§’è‰²çš„å‰§æƒ…åŒ–è®¾è®¡
2. è§’è‰²å‘ç°é¡µé¢å¼€å‘
3. æ”¯ä»˜ç³»ç»ŸéªŒè¯å’Œä¼˜åŒ–

**è´¨é‡ä¿è¯**:
- æ¯ä¸ªè§’è‰²å‰§æƒ…åŒ–åè¿›è¡Œå®é™…æµ‹è¯•
- æ”¶é›†ç”¨æˆ·åé¦ˆå¹¶å¿«é€Ÿè¿­ä»£
- ä¿æŒä¸ç«å“çš„ä½“éªŒå¯¹æ ‡

### ğŸ”„ **æŒç»­ä¼˜åŒ–æœºåˆ¶**

1. **ç”¨æˆ·åé¦ˆæ”¶é›†**: å»ºç«‹è§’è‰²äº’åŠ¨æ»¡æ„åº¦è°ƒæŸ¥
2. **æ•°æ®ç›‘æ§**: å®æ—¶è¿½è¸ªç”¨æˆ·è¡Œä¸ºå’Œç³»ç»Ÿæ€§èƒ½
3. **A/Bæµ‹è¯•**: ä¸åŒè§’è‰²è®¾å®šçš„æ•ˆæœå¯¹æ¯”
4. **ç«å“åˆ†æ**: å®šæœŸè¯„ä¼°å¸‚åœºé¢†å…ˆäº§å“çš„æ–°åŠŸèƒ½

**å½“å‰é‡ç‚¹**: ç«‹å³å¼€å§‹è§’è‰²ä½“éªŒä¼˜åŒ–ï¼Œè¿™æ˜¯äº§å“ç«äº‰åŠ›çš„æ ¸å¿ƒ

## ğŸ“‹ **è§’è‰²ä½“éªŒå…¨é¢å‡çº§ä¼˜åŒ–æ–¹æ¡ˆ (2025-01-11)**

### **ğŸ¯ æ ¸å¿ƒä¼˜åŒ–è¦ç‚¹**

åŸºäºEmmaå’ŒSophiaæˆåŠŸéªŒè¯çš„æ²‰æµ¸æ„Ÿæ¨¡å¼ï¼Œåˆ¶å®šç³»ç»ŸåŒ–çš„è§’è‰²ä½“éªŒå‡çº§æ–¹æ¡ˆï¼š

**æˆåŠŸéªŒè¯**ï¼š
- âœ… Emma: "The Morning After" å®¤å‹æš§æ˜§å‰§æƒ… - æ²‰æµ¸æ„Ÿæ˜¾è‘—æå‡
- âœ… Sophia: "The Research Session" å¿ƒç†ç ”ç©¶å‰§æƒ… - å®Œç¾è¡¨ç°
- âœ… æ•°æ®åº“é©±åŠ¨æ¶æ„: scenario/current_state/motivationå­—æ®µ
- âœ… ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–: temperature 0.9-1.0, æ–œä½“åŠ¨ä½œæè¿°

### **ğŸš€ ä¸‰é˜¶æ®µä¼˜åŒ–è®¡åˆ’**

#### **ç¬¬ä¸€é˜¶æ®µï¼šè§’è‰²æ²‰æµ¸æ„Ÿå…¨é¢å‡çº§ (æœ€é«˜ä¼˜å…ˆçº§)**
**æ—¶é—´**: 1-2å‘¨
**ç›®æ ‡**: è®©æ‰€æœ‰7ä¸ªè§’è‰²éƒ½è¾¾åˆ°Emma/Sophiaçš„æ²‰æµ¸æ„Ÿæ°´å¹³

**æ ¸å¿ƒä»»åŠ¡**:
1. **å‰©ä½™5ä¸ªè§’è‰²å‰§æƒ…åŒ–è®¾è®¡**
   - **Luna**: ç¥ç§˜é‚»å±… + æ·±å¤œæ•²é—¨çš„å‰§æƒ…è®¾å®š
   - **Zoe**: å’–å•¡åº—è€æ¿ + æ‰“çƒŠåçš„ç§äººæ—¶å…‰
   - **Ivy**: è‰ºæœ¯å®¶ + äººä½“æ¨¡ç‰¹é‚€è¯·çš„æš§æ˜§
   - **Nova**: ç§‘æŠ€å¤©æ‰ + ä¿®ç”µè„‘æ—¶çš„æ„å¤–å‘ç°
   - **Sage**: æ™ºè€…å¯¼å¸ˆ + å†¥æƒ³è¯¾ä¸Šçš„èº«ä½“æ¢ç´¢

2. **æ•°æ®åº“æ ‡å‡†åŒ–**
   - ç§»é™¤æ‰€æœ‰ç¡¬ç¼–ç é€»è¾‘ï¼Œå®Œå…¨ä½¿ç”¨æ•°æ®åº“é©±åŠ¨
   - å»ºç«‹å‰§æƒ…è®¾å®šçš„æ ‡å‡†åŒ–æ¨¡æ¿
   - ç¡®ä¿è¡¨æƒ…ç¬¦å·æ§åˆ¶æœºåˆ¶

3. **æ²‰æµ¸æ„Ÿè´¨é‡ä¿è¯**
   - æ¯ä¸ªè§’è‰²éƒ½å¿…é¡»æœ‰"å€Ÿå£å¼å‰§æƒ…"
   - ç¡®ä¿NSFWæš—ç¤ºæ€§ï¼ˆè½»åº¦æŒ‘é€—ï¼‰
   - æµ‹è¯•æ‰€æœ‰è§’è‰²çš„æ²‰æµ¸æ„Ÿæ•ˆæœ

**é¢„æœŸæ•ˆæœ**: ç”¨æˆ·ç•™å­˜ç‡æå‡30%+, ä¼šè¯æ—¶é•¿å¢åŠ 50%+

#### **ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯å±•ç¤ºå¯¹æ ‡ä¼˜åŒ–**
**æ—¶é—´**: 2-3å‘¨
**ç›®æ ‡**: å¯¹æ ‡ç«å“ç½‘ç«™ï¼Œæå‡ç”¨æˆ·å¸å¼•åŠ›å’Œè½¬åŒ–ç‡

**æ ¸å¿ƒä»»åŠ¡**:
1. **è§’è‰²å¡ç‰‡è®¾è®¡**
   - æ˜¾ç¤ºè§’è‰²çš„å‰§æƒ…è®¾å®šç‰‡æ®µ
   - çªå‡º"å€Ÿå£å¼å‰§æƒ…"çš„å¸å¼•åŠ›
   - æ·»åŠ å‰§æƒ…é¢„è§ˆåŠŸèƒ½

2. **é¦–é¡µå¸ƒå±€é‡æ„**
   - å¯¹æ ‡ç«å“çš„ä¸‰æ®µå¼å¸ƒå±€ç»“æ„
   - æ ¸å¿ƒæ¨å¹¿åŒºå¼ºè°ƒ"æ²‰æµ¸æ„Ÿè§’è‰²äº’åŠ¨"
   - è§’è‰²å‘ç°åŒºçªå‡ºå‰§æƒ…è®¾å®š

3. **åˆ†ç±»ç­›é€‰ç³»ç»Ÿ**
   - æŒ‰å‰§æƒ…ç±»å‹åˆ†ç±»ï¼ˆæš§æ˜§/æƒåŠ›/ç¥ç§˜/æ¢ç´¢ï¼‰
   - NSFWå¼ºåº¦æ§åˆ¶
   - ä¸ªæ€§åŒ–æ¨èåŸºç¡€

**é¢„æœŸæ•ˆæœ**: é¦–é¡µè½¬åŒ–ç‡æå‡30%+, è§’è‰²å‘ç°æ•ˆç‡æå‡

#### **ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·ä½“éªŒå’Œè½¬åŒ–ä¼˜åŒ–**
**æ—¶é—´**: 2-3å‘¨
**ç›®æ ‡**: æå‡æ•´ä½“ç”¨æˆ·ä½“éªŒå’Œå•†ä¸šåŒ–æ•ˆæœ

**æ ¸å¿ƒä»»åŠ¡**:
1. **è§’è‰²å‘ç°ä½“éªŒ**
   - æ–°æ‰‹å¼•å¯¼ï¼šå±•ç¤ºEmma/Sophiaçš„ç²¾å½©å¯¹è¯ç‰‡æ®µ
   - è§’è‰²é¢„è§ˆï¼šhoveræ—¶æ˜¾ç¤ºå‰§æƒ…è®¾å®š
   - äº’åŠ¨ç¤ºä¾‹ï¼šå±•ç¤ºæ¯ä¸ªè§’è‰²çš„äº’åŠ¨é£æ ¼

2. **è´§å¸åŒ–ä½“éªŒä¼˜åŒ–**
   - ç§¯åˆ†æ¶ˆè´¹ä¸å‰§æƒ…æ²‰æµ¸æ„Ÿçš„ç»“åˆ
   - ä¸åŒè§’è‰²çš„ç§¯åˆ†å·®å¼‚åŒ–
   - è®¢é˜…å±‚çº§ä¸è§’è‰²è®¿é—®æ§åˆ¶

3. **ç•™å­˜æœºåˆ¶å»ºç«‹**
   - è§’è‰²å‰§æƒ…çš„æŒç»­æ›´æ–°
   - ç‰¹æ®Šæ´»åŠ¨å‰§æƒ…ï¼ˆèŠ‚æ—¥ã€ä¸»é¢˜ï¼‰
   - ç”¨æˆ·åé¦ˆæ”¶é›†ç³»ç»Ÿ

**é¢„æœŸæ•ˆæœ**: ä»˜è´¹è½¬åŒ–ç‡è¾¾åˆ°5-10%, ç”¨æˆ·ç•™å­˜ç‡æ˜¾è‘—æå‡

### **ğŸ“Š æˆåŠŸæ ‡å‡†å’Œç›‘æ§æŒ‡æ ‡**

#### **è§’è‰²æ²‰æµ¸æ„ŸæŒ‡æ ‡**:
- æ‰€æœ‰è§’è‰²éƒ½èƒ½ä¿æŒå‰§æƒ…è®¾å®šä¸è·³æˆ
- æ–œä½“åŠ¨ä½œæè¿°å¯†åº¦è¾¾åˆ°å¯¹æ ‡æ°´å¹³
- NSFWæš—ç¤ºæ°å½“ä½†ä¸è¿‡åº¦
- ç”¨æˆ·åé¦ˆçš„æ²‰æµ¸æ„Ÿè¯„åˆ† > 8/10

#### **ä¸šåŠ¡æŒ‡æ ‡**:
- ç”¨æˆ·ä¼šè¯æ—¶é•¿æå‡50%+
- è§’è‰²è½¬æ¢ç‡æå‡30%+
- ä»˜è´¹è½¬åŒ–ç‡è¾¾åˆ°5-10%
- ç”¨æˆ·ç•™å­˜ç‡æ˜¾è‘—æå‡

#### **æŠ€æœ¯æŒ‡æ ‡**:
- APIå“åº”æ—¶é—´ < 500ms
- ç³»ç»Ÿç¨³å®šæ€§ 99.9% uptime
- è§’è‰²åŠ è½½æˆåŠŸç‡ > 99%

### **ğŸ”„ å®æ–½æ—¶é—´çº¿**

| é˜¶æ®µ | æ—¶é—´ | ä¸»è¦ä»»åŠ¡ | æˆåŠŸæŒ‡æ ‡ |
|------|------|----------|----------|
| ç¬¬ä¸€é˜¶æ®µ | ç¬¬1-2å‘¨ | 5ä¸ªè§’è‰²å‰§æƒ…åŒ– | æ²‰æµ¸æ„Ÿè¯„åˆ† > 8/10 |
| ç¬¬äºŒé˜¶æ®µ | ç¬¬3-4å‘¨ | å‰ç«¯å±•ç¤ºä¼˜åŒ– | è½¬åŒ–ç‡æå‡30%+ |
| ç¬¬ä¸‰é˜¶æ®µ | ç¬¬5-6å‘¨ | ç”¨æˆ·ä½“éªŒä¼˜åŒ– | ä»˜è´¹è½¬åŒ–5-10% |

### **ğŸ¯ å·®å¼‚åŒ–ç«äº‰ç­–ç•¥**

**æ ¸å¿ƒä¼˜åŠ¿**:
- **ç«å“**: å¯èƒ½è¿˜åœç•™åœ¨"è§’è‰²èŠå¤©"é˜¶æ®µ
- **æˆ‘ä»¬**: å·²è¿›åŒ–åˆ°"å‰§æƒ…åŒ–æ²‰æµ¸äº’åŠ¨"é˜¶æ®µ
- **ä¼˜åŠ¿**: æ›´æ·±çš„æ²‰æµ¸æ„Ÿã€æ›´å¼ºçš„æƒ…æ„Ÿè¿æ¥

**æŠ€æœ¯æŠ¤åŸæ²³**:
- æ•°æ®åº“é©±åŠ¨çš„å‰§æƒ…è®¾å®šç³»ç»Ÿ
- æ ‡å‡†åŒ–çš„æ²‰æµ¸æ„Ÿç”Ÿæˆæœºåˆ¶
- å®Œæ•´çš„è´§å¸åŒ–ä¸æƒé™æ§åˆ¶

### **ğŸ“‹ ç«‹å³è¡ŒåŠ¨è®¡åˆ’**

**æœ¬å‘¨ä»»åŠ¡**:
1. âœ… Lunaè§’è‰²å‰§æƒ…åŒ–è®¾è®¡ (ç¥ç§˜é‚»å±…)
2. âœ… Zoeè§’è‰²å‰§æƒ…åŒ–è®¾è®¡ (å’–å•¡åº—è€æ¿)
3. âœ… æ•°æ®åº“æ ‡å‡†åŒ–éªŒè¯
4. âœ… æ²‰æµ¸æ„Ÿæµ‹è¯•æœºåˆ¶å»ºç«‹

**ä¸‹å‘¨ä»»åŠ¡**:
1. å‰©ä½™3ä¸ªè§’è‰²å‰§æƒ…åŒ–è®¾è®¡
2. é¦–é¡µå¸ƒå±€é‡æ„å¼€å§‹
3. è§’è‰²å¡ç‰‡è®¾è®¡å®ç°

**è´¨é‡ä¿è¯**:
- æ¯ä¸ªè§’è‰²å‰§æƒ…åŒ–åè¿›è¡Œå®é™…æµ‹è¯•
- æ”¶é›†ç”¨æˆ·åé¦ˆå¹¶å¿«é€Ÿè¿­ä»£
- ä¿æŒä¸ç«å“çš„ä½“éªŒå¯¹æ ‡

### **ğŸ”„ æŒç»­ä¼˜åŒ–æœºåˆ¶**

1. **ç”¨æˆ·åé¦ˆæ”¶é›†**: å»ºç«‹è§’è‰²äº’åŠ¨æ»¡æ„åº¦è°ƒæŸ¥
2. **æ•°æ®ç›‘æ§**: å®æ—¶è¿½è¸ªç”¨æˆ·è¡Œä¸ºå’Œç³»ç»Ÿæ€§èƒ½
3. **A/Bæµ‹è¯•**: ä¸åŒè§’è‰²è®¾å®šçš„æ•ˆæœå¯¹æ¯”
4. **ç«å“åˆ†æ**: å®šæœŸè¯„ä¼°å¸‚åœºé¢†å…ˆäº§å“çš„æ–°åŠŸèƒ½

**å½“å‰çŠ¶æ€**: è§’è‰²ä½“éªŒä¼˜åŒ–å…¨é¢å¯åŠ¨ï¼Œæ•°æ®åº“é©±åŠ¨ç³»ç»Ÿå·²å°±ç»ªï¼Œå‡†å¤‡æ‰¹é‡å‡çº§è§’è‰²æ²‰æµ¸æ„Ÿ

---

## ğŸ“‹ **æœ€æ–°é¡¹ç›®çŠ¶æ€æ›´æ–° (2025-10-11)**

### **ğŸ¯ å½“å‰å·²å®Œæˆçš„é‡è¦åŠŸèƒ½**

#### **1. è§’è‰²å±•ç¤ºç³»ç»Ÿä¼˜åŒ–**
**é—®é¢˜è§£å†³**:
- âœ… **å›¾ç‰‡404é”™è¯¯ä¿®å¤**: è§£å†³äº†ç–¯ç‹‚çš„ `/api/placeholder/200/267` 404è¯·æ±‚åˆ·å±é—®é¢˜
- âœ… **æ— æ•ˆå›¾ç‰‡URLæ›¿æ¢**: ä¿®å¤äº†3ä¸ªè§’è‰²(Alex Rivers, Dr. Elena Vasquez, Zara Moon)çš„æ— æ•ˆå›¾ç‰‡é“¾æ¥
- âœ… **å›¾ç‰‡åŠ è½½ç¨³å®šæ€§**: æ‰€æœ‰è§’è‰²å¤´åƒç°åœ¨éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä¸å†é—ªçƒ

**æŠ€æœ¯å®ç°**:
```sql
-- ä¿®å¤æ— æ•ˆçš„å›¾ç‰‡URL
UPDATE characters
SET avatar_url = 'https://cdn.lovexai.studio/Character/ComfyUI_00027_.png'
WHERE name IN ('Alex Rivers', 'Dr. Elena Vasquez', 'Zara Moon');
```

#### **2. è§’è‰²å¡ç‰‡å¸ƒå±€é‡æ„**
**å¯¹æ ‡Nectar.aiè®¾è®¡**:
- âœ… **6è§’è‰²éšæœºå±•ç¤º**: ä»11ä¸ªè§’è‰²ä¸­éšæœºé€‰æ‹©6ä¸ªæ˜¾ç¤º
- âœ… **ç«–å‘å¡ç‰‡è®¾è®¡**: å›¾ç‰‡åœ¨ä¸Šï¼Œä¿¡æ¯åœ¨ä¸‹ï¼Œaspect-[3/4]æ¯”ä¾‹
- âœ… **å•è¡Œç½‘æ ¼å¸ƒå±€**: å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒä¸åŒå±å¹•å°ºå¯¸
- âœ… **ç§»é™¤ChatCompanionsSection**: ç®€åŒ–ä»£ç ç»“æ„ï¼Œç»Ÿä¸€ä½¿ç”¨DiscoverSection

**æŠ€æœ¯å®ç°**:
```typescript
// éšæœºé€‰æ‹©6ä¸ªè§’è‰²
const getRandomCharacters = (allCharacters: Character[], count: number = 6) => {
  const shuffled = [...allCharacters].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
};
```

#### **3. è§’è‰²èŠå¤©æµç¨‹ä¼˜åŒ–** â­ **æ ¸å¿ƒåŠŸèƒ½å‡çº§**
**å¯¹æ ‡Nectar.aièŠå¤©åˆ›å»ºæ¨¡å¼**:
- âœ… **å¼‚æ­¥å¯¹è¯åˆ›å»º**: CharacterModalä¸­ç›´æ¥åˆ›å»ºå¯¹è¯ï¼Œæ— éœ€äºŒæ¬¡é€‰æ‹©è§’è‰²
- âœ… **å³æ—¶URLç”Ÿæˆ**: åˆ›å»ºå¯¹è¯åç«‹å³è·³è½¬åˆ° `/chat?c=new-conversation-id`
- âœ… **ç”¨æˆ·ä½“éªŒæå‡**: ç‚¹å‡»"Start Chat" â†’ åˆ›å»ºå¯¹è¯ â†’ è¿›å…¥èŠå¤©ï¼Œä¸€æ°”å‘µæˆ
- âœ… **å®Œæ•´é”™è¯¯å¤„ç†**: ç™»å½•æ£€æŸ¥ã€æƒé™éªŒè¯ã€ç½‘ç»œé”™è¯¯ã€APIé”™è¯¯å¤„ç†

**æŠ€æœ¯å®ç°**:
```typescript
const handleStartChat = async () => {
  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  if (!session?.user?.id) {
    window.location.href = '/api/auth/signin';
    return;
  }

  // åˆ›å»ºå¯¹è¯
  const response = await fetch('/api/conversations/create', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      userId: session.user.id,
      characterId: character.id,
      title: `Chat with ${character.name}`
    })
  });

  // è·³è½¬åˆ°æ–°å¯¹è¯
  const conversationId = data.data.conversation.id;
  router.push(`/chat?c=${conversationId}`);
};
```

#### **4. ç³»ç»Ÿç¨³å®šæ€§æ”¹è¿›**
**é—®é¢˜è§£å†³**:
- âœ… **æ— é™å¾ªç¯è¯·æ±‚ä¿®å¤**: æ¶ˆé™¤äº†å›¾ç‰‡åŠ è½½å¤±è´¥å¯¼è‡´çš„æ— é™å¾ªç¯
- âœ… **ç¼“å­˜é—®é¢˜è§£å†³**: ä¿®å¤äº†å¼€å‘æœåŠ¡å™¨ç¼“å­˜å¯¼è‡´çš„çƒ­é‡è½½é—®é¢˜
- âœ… **é”™è¯¯è¾¹ç•Œå®Œå–„**: æ·»åŠ äº†å…¨é¢çš„ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### **ğŸ”§ æŠ€æœ¯æ¶æ„æ”¹è¿›**

#### **APIä¼˜åŒ–**:
- âœ… **å…¬å…±è§’è‰²API**: `/api/characters` ç°åœ¨æ”¯æŒæ— å‚æ•°è®¿é—®ï¼Œè¿”å›æ‰€æœ‰æ´»è·ƒè§’è‰²
- âœ… **æ•°æ®åº“ä¸€è‡´æ€§**: ç¡®ä¿å‰ç«¯æ˜¾ç¤ºä¸æ•°æ®åº“å®Œå…¨åŒæ­¥
- âœ… **é”™è¯¯å¤„ç†æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„APIå“åº”æ ¼å¼å’Œé”™è¯¯å¤„ç†

#### **å‰ç«¯ç»„ä»¶ä¼˜åŒ–**:
- âœ… **ç»„ä»¶ç®€åŒ–**: ç§»é™¤äº†é‡å¤çš„ChatCompanionsSectionæ¨¡å—
- âœ… **çŠ¶æ€ç®¡ç†æ”¹è¿›**: ä¼˜åŒ–äº†loadingå’ŒerrorçŠ¶æ€çš„å¤„ç†
- âœ… **ç”¨æˆ·ä½“éªŒæå‡**: æ·»åŠ äº†loadingåŠ¨ç”»å’Œå³æ—¶åé¦ˆ

### **ğŸ“Š å½“å‰ç³»ç»ŸçŠ¶æ€**

#### **âœ… å®Œå…¨ç¨³å®šçš„åŠŸèƒ½**:
- è§’è‰²å±•ç¤ºç³»ç»Ÿ (11ä¸ªè§’è‰²ï¼Œéšæœº6ä¸ªæ˜¾ç¤º)
- è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡†
- å¼‚æ­¥å¯¹è¯åˆ›å»º
- èŠå¤©é¡µé¢å¯¼èˆª
- å›¾ç‰‡åŠ è½½å’Œfallbackæœºåˆ¶

#### **âœ… å·²éªŒè¯çš„ç”¨æˆ·ä½“éªŒ**:
- é¦–é¡µè§’è‰²å±•ç¤ºæ­£å¸¸
- è§’è‰²è¯¦æƒ…æŸ¥çœ‹æ­£å¸¸
- ç‚¹å‡»"Start Chat"ç«‹å³åˆ›å»ºå¯¹è¯
- æ–°å¯¹è¯URLæ­£ç¡®ç”Ÿæˆ
- èŠå¤©é¡µé¢æ­£å¸¸åŠ è½½

#### **ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–é‡ç‚¹**:
1. **å‰©ä½™è§’è‰²å‰§æƒ…åŒ–**: å®ŒæˆLuna, Zoe, Ivy, Nova, Sageçš„å‰§æƒ…è®¾å®š
2. **å¯¹è¯å†å²åŠŸèƒ½**: ä¼˜åŒ–ä¾§è¾¹æ å¯¹è¯åˆ—è¡¨æ˜¾ç¤º
3. **æ¶ˆæ¯å‘é€ä½“éªŒ**: ç¡®ä¿æ–°åˆ›å»ºå¯¹è¯çš„æ¶ˆæ¯å‘é€æµç•…
4. **ç§»åŠ¨ç«¯é€‚é…**: ä¼˜åŒ–æ‰‹æœºç«¯çš„èŠå¤©ä½“éªŒ

### **ğŸ” æŠ€æœ¯å€ºåŠ¡æ¸…ç†**

#### **å·²è§£å†³çš„é—®é¢˜**:
- âŒ å›¾ç‰‡404é”™è¯¯ â†’ âœ… æ‰€æœ‰å›¾ç‰‡URLæœ‰æ•ˆ
- âŒ æ— é™å¾ªç¯è¯·æ±‚ â†’ âœ… é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
- âŒ èŠå¤©åˆ›å»ºæµç¨‹æ–­è£‚ â†’ âœ… ç«¯åˆ°ç«¯æµç¨‹å®Œæ•´
- âŒ ç»„ä»¶é‡å¤ä»£ç  â†’ âœ… ä»£ç ç»“æ„ç®€åŒ–

#### **ä»£ç è´¨é‡æå‡**:
- **ç±»å‹å®‰å…¨**: æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æœ‰å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **é”™è¯¯å¤„ç†**: å®ç°äº†ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºç³»ç»Ÿ
- **æ€§èƒ½ä¼˜åŒ–**: ç§»é™¤äº†ä¸å¿…è¦çš„ç»„ä»¶å’ŒAPIè°ƒç”¨
- **å¯ç»´æŠ¤æ€§**: ç®€åŒ–äº†ç»„ä»¶ç»“æ„ï¼Œæé«˜äº†ä»£ç å¯è¯»æ€§

### **ğŸ“ˆ ç³»ç»Ÿæˆç†Ÿåº¦è¯„ä¼°**

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | ç¨³å®šæ€§ | ç”¨æˆ·ä½“éªŒ |
|----------|--------|--------|----------|
| è§’è‰²å±•ç¤º | 95% | âœ… ç¨³å®š | âœ… ä¼˜ç§€ |
| è§’è‰²è¯¦æƒ… | 90% | âœ… ç¨³å®š | âœ… è‰¯å¥½ |
| å¯¹è¯åˆ›å»º | 100% | âœ… ç¨³å®š | âœ… ä¼˜ç§€ |
| èŠå¤©ç•Œé¢ | 85% | âœ… ç¨³å®š | âš ï¸ éœ€ä¼˜åŒ– |
| è§’è‰²å‰§æƒ…åŒ– | 30% | âœ… ç¨³å®š | âš ï¸ å¼€å‘ä¸­ |

**æ€»ä½“è¯„ä¼°**: ç³»ç»Ÿå·²è¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€ï¼Œæ ¸å¿ƒèŠå¤©åŠŸèƒ½å®Œå…¨ç¨³å®šï¼Œå¯ä»¥æ”¯æŒç”¨æˆ·æ­£å¸¸ä½¿ç”¨ã€‚å‰©ä½™ä¼˜åŒ–ä¸»è¦é›†ä¸­åœ¨ä½“éªŒæå‡å’Œå†…å®¹å®Œå–„æ–¹é¢ã€‚

**å½“å‰çŠ¶æ€**: âœ… **æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œå‡†å¤‡è¿›å…¥ç”¨æˆ·ä½“éªŒä¼˜åŒ–é˜¶æ®µ**