# 前后端分离分析

## 📊 可行性评估

| 方案 | 复杂度 | 工作量 | 推荐度 |
|------|--------|--------|--------|
| 完整分离 | ⭐⭐⭐⭐⭐ | 1 周+ | ❌ 不推荐 |
| 混合模式 | ⭐⭐ | 3-5 天 | ✅ 推荐 |
| 不分离 | ⭐ | 0 | ✅✅ 最推荐 |

## 🎯 当前架构

```
Next.js 全栈应用
├── 前端: React/Next.js (app/[locale]/)
├── API: Next.js API Routes (app/api/)
└── 数据: Convex (外部 BaaS)
```

**特点**: 前后端天然融合，Next.js 的核心优势。

## ❌ 完全分离的问题

### 需要重写

| 部分 | 现状 | 分离后 |
|------|------|--------|
| API Routes | Next.js 内置 | 改用 Express/Fastify |
| NextAuth | 深度集成 Next.js | 需要重新配置 |
| 所有 API 调用 | 内部调用 | 改为 fetch + CORS |
| SSR/SSG | Next.js 自动 | 完全丢失 |

### 工作量

- 重写 15 个 API 端点
- 改造所有前端 API 调用
- 配置 CORS
- 处理认证 token 传递
- 预计：**1-2 周**

## ✅ 混合模式（推荐）

### 架构

```
┌─────────────────┐      ┌─────────────────┐
│   Vercel        │      │   自建 VPS      │
│                 │      │                 │
│ ✅ 前端页面     │      │ ✅ 支付 API     │
│ ✅ /api/auth    │◄────►│ ✅ 上传 API     │
│ ✅ /api/otp     │      │ ✅ Webhook      │
└─────────────────┘      └─────────────────┘
```

### 优势

- NextAuth 无需改动（保留在 Vercel）
- 渐进式迁移
- 降低复杂度
- 风险可控

### 工作量

- 搭建独立后端: 4-6h
- 迁移支付 API: 8-12h
- 前端改造: 8-12h
- 测试: 8-10h
- **总计: 3-5 天**

## 🎯 最终建议

### 如果必须分离

1. **认证保留在 Vercel** - NextAuth 最难迁移
2. **只迁移业务 API** - 支付、上传等
3. **前端混合调用** - 两个域名都用

### 如果不紧急

**推荐保持现状** - Next.js 全栈架构的核心优势就是融合。

除非有明确的性能或成本问题，否则没必要分离。

## 📋 API 端点清单

### 认证相关（保留在 Vercel）
- `/api/auth/[...nextauth]` ⭐⭐⭐⭐⭐ 最难
- `/api/auth/send-otp`
- `/api/auth/verify-otp`

### 业务相关（可迁移）
- `/api/checkout/*` (6 个)
- `/api/upload-image`
- `/api/stripe-notify`
- `/api/*-webhook` (4 个)

---

**结论**: 前后端分离技术可行，但工作量巨大。建议优先考虑混合模式或不分离。
