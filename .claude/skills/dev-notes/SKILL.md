# Dev Notes - Technical Discussion Summary Skill

## 简介
当你和用户进行了深入的技术讨论后，调用此 skill 会自动梳理总结整个对话中的知识点和疑问，然后分类写入项目文档中。

## 适用场景

### 何时使用
- 技术方案讨论结束后
- 问题排查和解决过程
- 代码 review 和架构讨论
- 新功能设计和实现讨论
- Bug 修复过程记录

### 不适合的场景
- 简单的问答（直接回答即可）
- 单个文件的代码解释（用 Code Explainer）
- 项目整体结构梳理（用 Module Mapper）

## 工作流程

### 第一步：分析对话内容

从当前的对话历史中提取：

1. **讨论的主题/问题**
   - 用户最初提出的问题
   - 涉及的文件、模块、功能

2. **关键知识点**
   - 技术概念解释
   - 架构设计思路
   - 代码实现细节
   - 最佳实践建议

3. **疑问和解答**
   - 用户提出的疑问
   - 给出的解答
   - 未解决的问题（如有）

4. **代码变更**
   - 修改的文件列表
   - 关键代码片段
   - 变更原因

### 第二步：分类整理

将提取的信息按以下维度分类：

**按技术领域分类：**
- 架构设计
- 前端开发
- 后端开发
- 数据库
- DevOps/部署
- 性能优化
- 安全性

**按文档类型分类：**
- 技术决策记录 (ADR)
- 问题排查记录
- 代码注释说明
- 开发规范建议

### 第三步：写入文档

根据内容类型，选择合适的文档位置：

**技术讨论记录：** `docs/technical-discussions.md`
**问题排查记录：** `docs/troubleshooting.md`
**架构决策记录：** `docs/architecture/adr-{slug}.md`
**代码注释：** 在相关代码文件中添加注释

## 文档格式规范

### 技术讨论记录格式

```markdown
## [日期] - [主题]

**背景：**
[讨论的背景和起因]

**讨论内容：**

### 关键知识点
- [知识点1]
- [知识点2]

### 疑问与解答
**Q: [用户问题]**
A: [解答]

### 相关文件
- `path/to/file1.ts:行号`
- `path/to/file2.ts:行号`

**结论：**
[讨论得出的结论或下一步行动]

---
```

### 问题排查记录格式

```markdown
## [日期] - [问题描述]

**问题现象：**
[用户报告的问题]

**排查过程：**
1. 检查 [检查项1] → 结果
2. 检查 [检查项2] → 结果
3. 检查 [检查项3] → 结果

**根本原因：**
[问题原因分析]

**解决方案：**
[采取的解决措施]

**相关文件：**
- `path/to/file:行号` - [变更说明]

**预防措施：**
[如何避免类似问题]

---
```

### 架构决策记录格式 (ADR)

```markdown
# ADR-[序号]: [决策标题]

**状态：** 提议中/已接受/已废弃/已替代

**日期：** YYYY-MM-DD

**背景：**
[为什么需要这个决策]

**决策：**
[做出的技术决策]

**原因：**
[选择这个方案的原因]

**后果：**
- 正面影响：
- 负面影响：
- 风险：

**替代方案：**
1. [方案1] - 未选择原因
2. [方案2] - 未选择原因

**相关文件：**
- [涉及的文件列表]
```

## 使用示例

### 示例 1：技术方案讨论

**用户调用：**
```
/dev-notes
```

**Agent 执行：**
1. 回顾对话历史，提取关于"积分系统重构"的讨论
2. 识别关键知识点：Convex 实时订阅、积分扣除时机、幂等性设计
3. 写入 `docs/technical-discussions.md`

**输出结果：**
```markdown
✅ 已更新技术讨论记录

📄 文件：docs/technical-discussions.md

📝 新增内容：
- 积分系统重构讨论（2024-12-03）
  - 积分扣除时机：AI 成功响应后扣费
  - 幂等性保证：通过消息状态检查
  - 相关文件：convex/actions.ts:153-159
```

### 示例 2：问题排查

**用户调用：**
```
/dev-notes
```

**Agent 执行：**
1. 回顾关于"用户等级权限检查失败"的排查过程
2. 记录问题现象、排查步骤、根本原因
3. 写入 `docs/troubleshooting.md`

## 智能分类规则

### 自动识别文档类型

| 关键词 | 文档类型 | 存储位置 |
|--------|----------|----------|
| 优化、性能、重构 | 性能优化 | `docs/performance.md` |
| bug、报错、失败 | 问题排查 | `docs/troubleshooting.md` |
| 设计、架构、方案 | 架构设计 | `docs/architecture/` |
| 部署、配置、环境 | DevOps | `docs/deployment.md` |
| 安全、权限、验证 | 安全性 | `docs/security.md` |

### 多主题处理

如果对话涉及多个主题：
1. 创建一个主记录，概述所有主题
2. 为每个主题创建子章节
3. 在对应文档中添加交叉引用

## 注意事项

### ✅ 要做的事
- 保持记录的结构化和可读性
- 使用代码引用格式（`file:line`）方便定位
- 记录决策的"为什么"，不只是"是什么"
- 包含日期和时间戳
- 标注未解决的疑问

### ❌ 不要做的事
- 不要复制粘贴整个对话
- 不要记录与项目无关的内容
- 不要过度细化（保持适当的抽象层级）
- 不要遗漏关键的代码引用

## 输出格式

执行完成后，向用户报告：

```markdown
📚 已整理技术讨论记录

📂 更新的文档：
- docs/technical-discussions.md (+3 topics)
- docs/troubleshooting.md (+1 issue)

📌 主要内容：
- 积分系统架构讨论
- AI 响应流式实现
- 权限检查问题修复

💡 未决事项：
- [ ] 图片生成后端 API 待实现
- [ ] 订阅过期自动降级待开发

🔗 查看文档：docs/technical-discussions.md
```

## 与其他 Skill 的配合

```markdown
## 文档化工作流

1️⃣ **技术讨论**
   ↓ 使用 Dev Notes 记录

2️⃣ **代码实现**
   ↓ 使用 Code Explainer 理解

3️⃣ **问题排查**
   ↓ 使用 Dev Notes 记录排查过程

4️⃣ **知识沉淀**
   → 形成项目文档库
```
